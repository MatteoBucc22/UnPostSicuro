<div class="max-w-7xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-3 gap-10">
  
  <!-- SEZIONE PRINCIPALE (EBOOK + SPECIALISTI) -->
  <div class="lg:col-span-2">
    <h1 class="text-4xl font-extrabold text-[#5EADB1] mb-10 tracking-tight">
      Il tuo carrello
    </h1>

    <!-- Carrello vuoto -->
    <div *ngIf="isEmpty" class="text-center bg-white/70 backdrop-blur-lg rounded-2xl shadow-lg p-12 border border-gray-200">
      <h2 class="text-2xl font-semibold text-gray-700 mb-4">Il carrello √® vuoto</h2>
      <p class="text-gray-500 mb-8">Aggiungi ebook o specialisti per iniziare.</p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a routerLink="/ebooks" class="px-8 py-3 bg-[#5EADB1] text-white font-semibold rounded-xl hover:bg-[#4c9397] transition-all shadow-md">
          üìö Esplora i nostri Ebook
        </a>
        <a routerLink="/specialists" class="px-8 py-3 bg-[#5EADB1] text-white font-semibold rounded-xl hover:bg-[#4c9397] transition-all shadow-md">
          üë©‚Äç‚öïÔ∏è Esplora i nostri Specialisti
        </a>
      </div>
    </div>

    <!-- Lista articoli -->
    <div *ngFor="let item of realCartItems" 
         class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-xl p-8 mb-12 border border-gray-100 hover:shadow-2xl transition-all duration-300">

      <!-- Info Ebook -->
      <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6 mb-8">
        <div class="flex items-center gap-6">
          <img [src]="item.ebooks?.image_url" 
               alt="Copertina ebook"
               class="w-28 h-40 object-cover rounded-xl shadow-sm border border-gray-200" />
          <div>
            <h2 class="text-2xl font-bold text-gray-800 mb-1">{{ item.ebooks?.title }}</h2>
            <p class="text-gray-500 text-sm">Autore: {{ item.ebooks?.author }}</p>
            <p class="text-gray-700 font-semibold mt-2">{{ item.ebooks?.price | currency:'EUR' }}</p>
          </div>
        </div>
        <button (click)="removeItem(item.id)"
                class="flex items-center gap-2 px-5 py-2 bg-red-500 text-white font-semibold rounded-xl shadow hover:bg-red-600 transition">
          <span>üóëÔ∏è</span> <span>Rimuovi</span>
        </button>
      </div>

      <!-- Sezione specialisti -->
      <div *ngIf="item.ebooks" class="mt-4">
        <h3 class="text-lg font-semibold text-gray-700 mb-3 flex items-center gap-2">
          <span>üë©‚Äç‚öïÔ∏è</span> Seleziona uno specialista per questo ebook
        </h3>

        <div class="relative group">
          <button (click)="scrollLeft(item.id)"
                  class="absolute left-0 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white shadow-md p-2 rounded-full hidden group-hover:block transition">
            ‚Üê
          </button>

          <div
            class="flex gap-6 overflow-x-auto scroll-smooth pb-4 no-scrollbar transition-all duration-300"
            [attr.data-id]="item.id"
            (wheel)="onScroll($event)"
          >
            <div *ngFor="let s of specialists"
                (click)="selectSpecialistForItem(item.id, s.id)"
                [class.ring-4]="item.selectedSpecialist === s.id"
                [class.ring-[#5EADB1]]="item.selectedSpecialist === s.id"
                class="flex-shrink-0 w-72 cursor-pointer transition-transform duration-300 hover:scale-105 hover:shadow-lg rounded-2xl">
              <app-specialist-card [specialist]="s"></app-specialist-card>
            </div>
          </div>

          <button (click)="scrollRight(item.id)"
                  class="absolute right-0 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white shadow-md p-2 rounded-full hidden group-hover:block transition">
            ‚Üí
          </button>
        </div>

        <p *ngIf="item.selectedSpecialist" class="text-green-600 mt-4 font-medium">
          ‚úÖ Specialista selezionato correttamente!
        </p>
      </div>
      <app-calendar
        *ngIf="item.selectedSpecialist && user"
        [specialistId]="item.selectedSpecialist"
        [userId]="user.id"
        #calendarComp>
      </app-calendar>
    

    </div>
  </div>



  <!-- SIDEBAR -->
  <aside class="bg-white/90 backdrop-blur-md shadow-xl rounded-2xl p-6 h-fit sticky top-6 border border-gray-100">
    <h2 class="text-2xl font-semibold text-gray-800 mb-6">Riepilogo ordine</h2>

    <div class="space-y-4 mb-6">
      <div class="flex justify-between text-gray-600">
        <span>Subtotale</span>
        <span class="font-medium">{{ subtotal | currency:'EUR' }}</span>
      </div>
      <div class="flex justify-between text-gray-600">
        <span>IVA (22%)</span>
        <span class="font-medium">{{ subtotal * 0.22 | currency:'EUR' }}</span>
      </div>
      <div class="flex justify-between text-gray-800 text-lg font-semibold border-t border-gray-200 pt-4">
        <span>Totale</span>
        <span class="text-[#5EADB1]">{{ subtotal * 1.22 | currency:'EUR' }}</span>
      </div>
    </div>

    <button (click)="checkout()"
            class="w-full py-3 text-lg bg-[#5EADB1] text-white font-semibold rounded-xl hover:bg-[#4c9397] shadow-md transition-all">
      Procedi al pagamento ‚Üí
    </button>
    <app-cart-paypal
      *ngIf="user?.id"
      [amount]="totalWithVAT"
      [userId]="user!.id"
      [appointmentId]="appointmentId">
    </app-cart-paypal>



    <p class="text-sm text-gray-500 text-center mt-4">
      Pagamenti sicuri con carta, PayPal o bonifico bancario.
    </p>
  </aside>
</div>
